%% Set the adjacency matrix A
% Link-distance R
A = zeros(16,16,9);
% R=1
A(:,:,1) = glattice(16);
% R=sqrt(2)
A(:,:,2) = gPlattice(16,1);
% R=2
A(:,:,3) = gPlattice(16,1);
A(1,3,3) = 1;
A(3,1,3) = 1;
A(1,9,3) = 1;
A(9,1,3) = 1;
A(2,4,3) = 1;
A(4,2,3) = 1;
A(3,11,3) = 1;
A(11,3,3) = 1;
A(4,12,3) = 1;
A(12,4,3) = 1;
A(5,7,3) = 1;
A(7,5,3) = 1;
A(6,14,3) = 1;
A(14,6,3) = 1;
A(6,8,3) = 1;
A(8,6,3) = 1;
A(7,15,3) = 1;
A(15,7,3) = 1;
A(8,16,3) = 1;
A(16,8,3) = 1;
A(9,11,3) = 1;
A(11,9,3) = 1;
A(10,12,3) = 1;
A(12,10,3) = 1;
A(13,15,3) = 1;
A(15,13,3) = 1;
A(14,16,3) = 1;
A(16,14,3) = 1;
% R=sqrt(5)
A(:,:,4) = A(:,:,3);
A(1,10,4) = 1;
A(10,1,4) = 1;
A(1,7,4) = 1;
A(7,1,4) = 1;
A(2,9,4) = 1;
A(9,2,4) = 1;
A(2,11,4) = 1;
A(11,2,4) = 1;
A(2,8,4) = 1;
A(8,2,4) = 1;
A(3,10,4) = 1;
A(10,3,4) = 1;
A(3,12,4) = 1;
A(12,3,4) = 1;
A(3,5,4) = 1;
A(5,3,4) = 1;
A(4,6,4) = 1;
A(6,4,4) = 1;
A(4,11,4) = 1;
A(11,4,4) = 1;
A(5,11,4) = 1;
A(11,5,4) = 1;
A(5,14,4) = 1;
A(14,5,4) = 1;
A(6,12,4) = 1;
A(12,6,4) = 1;
A(6,15,4) = 1;
A(15,6,4) = 1;
A(6,13,4) = 1;
A(13,6,4) = 1;
A(7,9,4) = 1;
A(9,7,4) = 1;
A(7,14,4) = 1;
A(14,7,4) = 1;
A(7,16,4) = 1;
A(16,7,4) = 1;
A(8,10,4) = 1;
A(10,8,4) = 1;
A(8,15,4) = 1;
A(15,8,4) = 1;
A(9,15,4) = 1;
A(15,9,4) = 1;
A(10,16,4) = 1;
A(16,10,4) = 1;
A(11,13,4) = 1;
A(13,11,4) = 1;
A(12,14,4) = 1;
A(14,12,4) = 1;
% R=sqrt(8)
A(:,:,5) = A(:,:,4);
A(1,11,5) = 1;
A(11,1,5) = 1;
A(2,12,5) = 1;
A(12,2,5) = 1;
A(3,9,5) = 1;
A(9,3,5) = 1;
A(4,10,5) = 1;
A(10,4,5) = 1;
A(5,15,5) = 1;
A(15,5,5) = 1;
A(6,16,5) = 1;
A(16,6,5) = 1;
A(7,13,5) = 1;
A(13,7,5) = 1;
A(8,14,5) = 1;
A(14,8,5) = 1;
% R=3
A(:,:,6) = A(:,:,5);
A(1,13,6) = 1;
A(13,1,6) = 1;
A(1,4,6) = 1;
A(4,1,6) = 1;
A(2,14,6) = 1;
A(14,2,6) = 1;
A(3,15,6) = 1;
A(15,3,6) = 1;
A(4,16,6) = 1;
A(16,4,6) = 1;
A(5,8,6) = 1;
A(8,5,6) = 1;
A(9,12,6) = 1;
A(12,9,6) = 1;
A(16,13,6) = 1;
A(13,16,6) = 1;
% R=sqrt(10)
A(:,:,7) = A(:,:,6);
A(1,14,7) = 1;
A(14,1,7) = 1;
A(1,8,7) = 1;
A(8,1,7) = 1;
A(2,13,7) = 1;
A(13,2,7) = 1;
A(2,15,7) = 1;
A(15,2,7) = 1;
A(3,14,7) = 1;
A(14,3,7) = 1;
A(3,16,7) = 1;
A(16,3,7) = 1;
A(4,15,7) = 1;
A(15,4,7) = 1;
A(4,5,7) = 1;
A(5,4,7) = 1;
A(5,12,7) = 1;
A(12,5,7) = 1;
A(8,9,7) = 1;
A(9,8,7) = 1;
A(9,16,7) = 1;
A(16,9,7) = 1;
A(12,13,7) = 1;
A(13,12,7) = 1;
% R=sqrt(13)
A(:,:,8) = A(:,:,7);
A(1,15,8) = 1;
A(15,1,8) = 1;
A(1,12,8) = 1;
A(12,1,8) = 1;
A(2,16,8) = 1;
A(16,2,8) = 1;
A(3,13,8) = 1;
A(13,3,8) = 1;
A(4,9,8) = 1;
A(9,4,8) = 1;
A(4,14,8) = 1;
A(14,4,8) = 1;
A(5,16,8) = 1;
A(16,5,8) = 1;
A(8,13,8) = 1;
A(13,8,8) = 1;
% R=sqrt(18)
A(:,:,9) = A(:,:,8);
A(1,16,9) = 1;
A(16,1,9) = 1;
A(4,13,9) = 1;
A(13,4,9) = 1;
%% plot color phase (varing k and sigma)
y0 = 0.4*rand(length(A)*2,1);
A1 = A(:,:,1); % change A1 from A(:,:,1) t0 A(:,:,9) (increasing link-distance)
t0 = 0;
tfinal = 9000;
k = 1:0.2:3;
sigma = 0.8:0.2:4;
K = zeros(length(k),length(sigma));
for i = 1:length(k)
    for j = 1:length(sigma)
        options = odeset('RelTol',1e-10,'AbsTol',1e-8);
        [t,y] = ode15s(@(t,y)rm_model(t,y,A1,k(i),sigma(j)),[t0,tfinal],y0,options); 
        % ode45 and ode15s get the same result
        q = t>8000; % make sure it is stable
        K(i,j) = state(A1,y,q,t);
        % will upload a new classifier to take place 'state'
    end
end
clims = [1 6];
imagesc(sigma,k,K,clims)
colorbar('southoutside','Ticks',[1,2,3,4,5,6],...
         'TickLabels',{'Others','Death',...
         'AC and death',...
         'CSOD',...
         'AC','SO'},'fontsize',14)
set(gca,'XDir','normal','fontsize',18)
set(gca,'YDir','normal','fontsize',18)
colormap(lines(6))
ylabel('k','fontsize',20);
xlabel('$\sigma$','fontsize',20)
